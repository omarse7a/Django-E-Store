{% extends 'layout.html' %}

{% load static %}
{% load bootstrap5 %}
{% load bootstrap_icons %}
{% bootstrap_css %}
{% bootstrap_javascript %}

{% block head %}
<link rel="stylesheet" href="{% static 'shopping/css/bag.css' %}">
{% endblock head %}

{% block main %}   
<!-- Navbar -->
<nav class="navbar navbar-expand-md bg-dark navbar-dark py-3" aria-label="Main navigation">
	<div class="container">
		<a href="#" class="navbar-brand">E-Store</a>

		<button 
			class="navbar-toggler" 
			type="button" 
			data-bs-toggle="collapse" 
			data-bs-target="#navmenu" 
			aria-controls="navmenu" 
			aria-expanded="false" 
			aria-label="Toggle navigation"
		>
			<span class="navbar-toggler-icon"></span>
		</button>

		<div class="collapse navbar-collapse" id="navmenu">
			<ul class="navbar-nav ms-auto">
				<li class="nav-item px-2 px-lg-4">
					<a href="{% url 'index' %}" class="nav-link" aria-label="Home">Home</a>
				</li>
				<li class="nav-item px-2 px-lg-4">
					<a href="{% url 'products' 'all' %}" class="nav-link" aria-label="Products">Products</a>
				</li>
			</ul>
		</div>
		<ul class="navbar-nav d-flex flex-row ms-auto">
			<li class="nav-item px-2 px-lg-3">
				<a href="#contact" class="nav-link" aria-label="Contact Info">{% bs_icon 'info-circle' size='1.2em' %}Contact</a>
			</li>
			<li class="nav-item">
				<a href="{% url 'bag' %}" class="nav-link" aria-label="Shopping Bag">{% bs_icon 'bag' size='1.2em' %}Bag</a>
			</li>
		</ul>
	</div>
</nav>

<div class="container">
	<!-- Message alerts -->
	{% if messages %}
	<div class="my-3">
		{% for message in messages %}
		<div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% else %}alert-info{% endif %} alert-dismissible square-border fade show" role="alert">
			{{ message }}
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
		{% endfor %}
	</div>
	{% endif %}
	<div class="row justify-content-between">
		<!-- shipping info -->
		<section class="col-md-7 p-5">
			<h2>Shipping Info</h2>
			<form action="{% url 'confirm_order' %}" method="post" id="shipping-form" class="row g-4 py-4">
				{% csrf_token %}
                {{ form.as_p }}
			</form>
		</section>

		<!-- order summary -->
		<aside class="col-md-5 p-5">
			<h2>Order Summary</h2>
			{% for item in bag_items %}
			<div class="d-flex justify-content-between align-items-center py-4">
				<a href="{% url 'product' item.product.id %}" class="btn btn-dark position-relative square-border">
					<img src="{{ item.product.main_image.url }}" alt="{{ item.product.name }}" class="img-fluid" style="max-height: 100px;">
					<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
						{{ item.quantity }}
						<span class="visually-hidden">quantity</span>
					</span>
				</a>
				<div>
					<p class="lead">{{ item.product.name }}</p>
					<small>{{ item.size }}</small>
				</div>
				<p class="lead">{{item.item_subtotal}} EGP</p>
			</div>
			{% endfor %}
			<div class="d-flex justify-content-between">
				<p>Subtotal</p>
				<p>{{bag.bag_total}} EGP</p>
			</div>
			<div class="d-flex justify-content-between">
				<p>Shipping</p>
				<p>{{shipping}} EGP</p>
			</div>
			<div class="d-flex justify-content-between">
				<h4>Total</h4>
				<h4>{{bag.bag_total | add:shipping}} EGP</h4>
			</div>
			<div class="mt-3">
				<button onclick="document.querySelector('#shipping-form').submit()" class="btn btn-primary square-border">Confirm Order</button>
				<a href="{% url 'bag' %}" class="btn btn-outline-dark square-border mx-3">Back To Bag</a>
			</div>
		</aside>
		
	</div>
</div>
{% endblock main %} 